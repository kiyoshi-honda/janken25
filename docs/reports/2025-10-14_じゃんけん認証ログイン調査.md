# 2025-10-14_じゃんけん認証・ログイン画面実装方法調査

## 調査日
2025年10月14日

## 調査目的
- ルートパス（http://localhost:8080/）にアクセスした際にログインページを表示し、ログイン後にじゃんけんページへ遷移させる方法を調査する。
- ユーザ名「yamada」、パスワード「tarou」でログインできるようにする。
- igakilab/springboot_samples の構成・実装例を参考にする。

## 調査内容
- Spring Bootで認証・認可を実装する場合、Spring Securityを利用するのが一般的。
- サンプルリポジトリ（igakilab/springboot_samples）では、`security` ディレクトリに `SecurityConfig.java` を配置する構成が推奨されている。
- 認証ユーザはインメモリ（InMemoryUserDetailsManager）で設定可能。
- ログイン画面はSpring Securityが自動生成する。
- 認証後、`/janken` へのアクセスが可能となるよう設定する。
- コントローラやサービスはMVC構成で分離し、画面遷移は既存の `JankenController` で対応可能。

## 発見事項
- `janken/build.gradle` に `spring-boot-starter-security` を追加する必要がある。
- `janken/src/main/java/oit/is/z9999/kaizi/janken/security/SecurityConfig.java` を新規作成し、インメモリユーザ（honda/kiyoshi）を設定する。
- `/janken` へのアクセスは認証必須とする。
- ログイン画面は自動生成されるため、Thymeleafテンプレートの修正は不要。
- 認証後は `JankenController` で `janken.html` が表示される。

## 推奨事項
- Spring Securityの依存追加とSecurityConfigの新規作成を行う。
- 認証ユーザは `yamada/tarou` で設定。
- `/janken` へのアクセスは認証必須。
- 画面遷移は既存のコントローラで対応可能。

## 参考コード例
```java
package oit.is.z9999.kaizi.janken.security;

import org.springframework.context.annotation.Bean;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.core.userdetails.User;
import org.springframework.security.core.userdetails.UserDetails;
import org.springframework.security.core.userdetails.UserDetailsService;
import org.springframework.security.provisioning.InMemoryUserDetailsManager;
import org.springframework.security.web.SecurityFilterChain;

public class SecurityConfig {
  @Bean
  public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {
    http
      .authorizeHttpRequests(authz -> authz
        .requestMatchers("/janken").authenticated()
        .anyRequest().permitAll()
      )
      .formLogin(form -> form
        .loginPage("/login").permitAll()
      );
    return http.build();
  }

  @Bean
  public UserDetailsService userDetailsService() {
    UserDetails user = User.withDefaultPasswordEncoder()
      .username("yamada")
      .password("tarou")
      .roles("USER")
      .build();
    return new InMemoryUserDetailsManager(user);
  }
}
```

## 参考URL
- https://github.com/igakilab/springboot_samples

---

この調査結果をもとに、計画フェーズで必要なファイル・手順を整理してください。
